<!DOCTYPE html>
<!-- ●ここからhtmlのhead● -->
<html>
 
<head>
  <meta charset="UTF-8">
  <title>大芝マップ5</title>
  <!-- ●表示幅を指定● -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- ●headタグ内にLeafletのcssとJavaScriptを指定● -->
  <!-- 【Leaflet 1.80】 -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
	integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
	crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
	integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
	crossorigin=""></script>
	
  <script> //ここからJavascriptで地図の機能をつくっていく
    function init() { //関数の定義。ここでは起動時に実行するもの（地図の表示）をまとめてある
      var map = L.map('mapcontainer', { zoomControl: true });
      map.setView([35.8844849, 137.9433395], 15); //大芝の座標

	    //ここから背景地図のリンク先xyzと出典attributionを設定
      var gsiattr = "<a href='http://portal.cyberjapan.jp/help/termsofuse.html' target='_blank'>地理院タイル</a>";//地理院地図のattribution（出典表記とリンク）
      var gsi = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', { attribution: gsiattr });//地理院地図（使わない）
      var gsipale = L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png', { attribution: gsiattr });//淡色地図
      var osm = L.tileLayer('http://tile.openstreetmap.jp/{z}/{x}/{y}.png',
        { attribution: "<a href='http://osm.org/copyright' target='_blank'>OpenStreetMap</a> contributors" });//オープンストリートマップ（使わない）
	    //年代別の航空写真も追加
	   var gsiphot = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg', { attribution: gsiattr });//最新写真
	   var gsiphot1974 = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/gazo1/{z}/{x}/{y}.jpg', { attribution: gsiattr });//1974年～1978年写真
	   var gsiphot1961 = L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/ort_old10/{z}/{x}/{y}.png', { attribution: gsiattr });//1961年～1969年写真
	    //長野県CS立体図（1m）
	    var naganocsver2 = L.tileLayer('https://tile.geospatial.jp/CS/VER2/{z}/{x}/{y}.png', 
	 	    { attribution: "<a href='https://www.geospatial.jp/ckan/dataset/nagano-csmap' target='_blank'>長野県CS立体図</a> contributors" });//長野県CS立体図（1m）
	  	
      //オーバーレイ用のタイルレイヤ
      //opacityで透過度を設定、maxNativeZoomを指定すると、それ以上のズームレベルのタイルデータは、指定のズームレベルのタイル画像を拡大して表示される
      var gsirelief = L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/relief/{z}/{x}/{y}.png', { opacity: 0.7, maxNativeZoom: 15, attribution: gsiattr });
      var gsirehillshademap = L.tileLayer('http://cyberjapandata.gsi.go.jp/xyz/hillshademap/{z}/{x}/{y}.png', { opacity: 0.5, maxNativeZoom: 16, attribution: gsiattr });

	    //背景地図（重ね合わせなし）とオーバーレイマップ（重ねあわせあり）を指定する
      var baseMaps = {
        "地理院淡色地図": gsipale,
        "地理院航空写真（最新）": gsiphot,
		    "地理院航空写真（1974-1978）": gsiphot1974,
		    "地理院航空写真（1961-1969）": gsiphot1961,
        "長野県CS立体図（1mタイル）": naganocsver2
      };
	     /* オーバーレイは一旦なしで
       var overlayMaps = {
        "色別標高図": gsirelief,
        "陰影起伏図": gsirehillshademap
       };
	    */
      L.control.layers(baseMaps/*, overlayMaps*/).addTo(map);
      gsi.addTo(map);
    }
    

    //現在地表示KITANOTE参照
    function setCurLocation(){
        if (navigator.geolocation == false){
          alert('現在地を取得できませんでした。');
          return;
        }
 
        function success(e) {
          var lat  = e.coords.latitude;
          var lng = e.coords.longitude;
          mymap.setView([lat, lng], 15);
          L.marker([lat,lng]).addTo(mymap).bindPopup('現在地').openPopup();
        };
 
        function error() {
          alert('現在地を取得できませんでした。');
        };
 
        navigator.geolocation.getCurrentPosition(success, error);
      }

    //ここから現在地表示機能（色んな人のを参考に作成）
    /*
    // 現在地ボタン
    function getPosi2() {
      var button = document.getElementById('button2');
	   if( watch_id>0 ){
	    // リアルタイム監視を停止
	     window.navigator.geolocation.clearWatch(watch_id);
	      watch_id = 0;                    // 監視識別IDに0をセット
	      button.textContent = "現在地"; // ボタン表記を変更
	   } else {
	      var p_options = {                // リアルタイム監視を開始
	      enableHighAccuracy: true,    // 高精度を要求する
	      timeout: 50000,              // 最大待ち時間（ミリ秒）
	      maximumAge: 0                // キャッシュ有効期間（ミリ秒）
	      };
        watch_id = window.navigator.geolocation.watchPosition(monitor,error,p_options); 
	      // ボタン表記を変更
	      button.textContent = "現在地停止";
	      }
      };  // getPosi2()  --------------- 
 
    function error(err) {
      console.warn('ERROR(' + err.code + '): ' + err.message);
      }; // error(err)  ---------------
 
    // リアルタイム監視
    function monitor(event){
	    if(event.coords.accuracy>1000){return};
        if( ( new Date().getTime()- watchTime )<minInterval ){return};
        watchTime = new Date().getTime();
	      var latitude = event.coords.latitude;       // 緯度
	      var longitude = event.coords.longitude;     // 経度
        document.querySelector('#accu').textContent = event.coords.accuracy.toFixed(0);
        var Pset = new L.LatLng(latitude,longitude);
        marktxt = latitude.toFixed(6)+ ', '+ longitude.toFixed(6);
        marker= L.marker(Pset).addTo(mapobj).bindPopup(marktxt).openPopup();
        mapobj.setView(Pset); //中心移動
      }; // monitor(event)  -----------------
      
      function drawMark( Pset ){
        marker= L.marker(Pset).addTo(mapobj).bindPopup(marktxt).openPopup();
      }; // drawMark( setP ) ------------------
    */

  </script>

 <style type="text/css">
   #btnCurLocation { height:25px; width: 100px;}
 </style>

</head>
 
<body onload="init()">
 <!-- ●タイトルと現在地ボタン● -->
  <div style="text-align:center;" >
    <span style="font-size:20px;">大芝マップ5Test</span>
    <button id="btnCurLocation" onClick="setCurLocation()">現在地表示</button>
    <!--<button id="button2" onclick="getPosi2()">現在地</button>-->
    </div>
  <!-- ●地図を表示● -->
  <div id="mapcontainer" style="position:absolute;top:35px;left:2px;right:2px;bottom:2px;"></div><!-- ここに地図を表示。隙間をあけて全画面。 -->
</body>
 
</html>

